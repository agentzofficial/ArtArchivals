<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>agent z Art Archivals</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <img id="fixed-bg" alt="Background" />
  <div style="text-align: center; margin-top: 20px;">
    <img src="serverImages/logo.png" alt="Art Archives Logo" style="max-width: 500px; height: auto;">
  </div>
  <div id="filter-bar"></div>
  <div class="gallery" id="gallery"></div>

  <div id="modal" class="modal">
    <span class="close">&times;</span>
    <div class="modal-content">

      <!-- Image + variant buttons wrapper -->
      <div class="modal-image-wrapper">
        <img id="modal-img" src="" alt="">
        <div class="variant-buttons"></div>
      </div>

      <!-- Textual details -->
      <h2 id="modal-title"></h2>
      <p id="modal-description"></p>
      <p id="modal-date" class="modal-date"></p>

      <!-- Social icons -->
      <div class="modal-icons"></div>
    </div>
  </div>

  <p class="navigation-hint">Use ← and → arrow keys to navigate</p>

  <script>
    let currentIndex = 0, artData = [];
    const includeTags = new Set(), excludeTags = new Set();
    const TAG_ORDER = [
      "Renders", "Drawings", "Screenshots", "Thumbnails", "Sneak Peaks", "Specials", "Branding"
    ];
  
    const filterBar = document.getElementById('filter-bar');
    const navHint = document.querySelector('.navigation-hint');
    const gallery = document.getElementById('gallery');
    const modal   = document.getElementById('modal');
    const imgEl   = document.getElementById('modal-img');
    const titleEl = document.getElementById('modal-title');
    const descEl  = document.getElementById('modal-description');
    const dateEl  = document.getElementById('modal-date');
    const iconsEl = document.querySelector('.modal-icons');
    const vbEl    = document.querySelector('.variant-buttons');
    const closeBtn= document.querySelector('.close');

    function showModal(index, variantIndex = 0) {
      const item = artData[index];
      if (!item) return;

      const variants = item.variants || [item.filename];
      imgEl.src = `images/${variants[variantIndex]}`;
      imgEl.alt = item.title;
      titleEl.textContent = item.title;
      descEl.textContent = item.description || '';
      dateEl.textContent = item.date || '';

      // social icons
      iconsEl.innerHTML = '';
      if (item.youtube)  iconsEl.innerHTML += `<a href="${item.youtube}" target="_blank"><img src="serverImages/youtube-icon.png" alt="YouTube"></a>`;
      if (item.twitter)  iconsEl.innerHTML += `<a href="${item.twitter}" target="_blank"><img src="serverImages/twitter-icon.png" alt="Twitter"></a>`;
      if (item.bluesky)  iconsEl.innerHTML += `<a href="${item.bluesky}" target="_blank"><img src="serverImages/bluesky-icon.png" alt="Bluesky"></a>`;

      // variant buttons (modal-only)
      vbEl.innerHTML = '';
      if (variants.length > 1) {
        variants.forEach((_, i) => {
          const btn = document.createElement('button');
          btn.className = 'variant-btn' + (i === variantIndex ? ' active' : '');
          btn.textContent = i + 1;
          btn.addEventListener('click', e => {
            e.stopPropagation();
            showModal(index, i);
          });
          vbEl.appendChild(btn);
        });
      }

      modal.style.display = 'flex';
      navHint.style.display = 'block';
    }

    fetch('data.json')
      .then(r => r.json())
      .then(data => {
        artData = data;
  
        // build filter buttons in order
        TAG_ORDER.forEach((tag, i) => {
          const btn = document.createElement('button');
          btn.textContent = tag;
          btn.className = 'filter-btn neutral';
          btn.dataset.tag = tag;
  
          btn.addEventListener('click', () => {
            const state = btn.classList.contains('neutral') ? 'include'
                        : btn.classList.contains('include') ? 'exclude'
                        : 'neutral';
            btn.className = 'filter-btn ' + state;
  
            includeTags.delete(tag);
            excludeTags.delete(tag);
            if (state === 'include') includeTags.add(tag);
            if (state === 'exclude') excludeTags.add(tag);
  
            renderGallery();
          });
  
          filterBar.appendChild(btn);
          if (i === 2) {
            const divider = document.createElement('span');
            divider.className = 'divider';
            divider.textContent = '|';
            filterBar.appendChild(divider);
          }
        });
  
        renderGallery();
      });
  
    function renderGallery() {
      gallery.innerHTML = '';
  
      const matchesFilter = (tags = []) => {
        for (const tag of excludeTags) if (tags.includes(tag)) return false;
        if (includeTags.size === 0) return true;
        for (const tag of includeTags) if (tags.includes(tag)) return true;
        return false;
      };
  
      artData.forEach((item, idx) => {
        if (!matchesFilter(item.tags)) return;
  
        const filename = (item.variants?.[0] || item.filename);
        const div = document.createElement('div');
        div.className = 'art-item';
        div.innerHTML = `
          <div class="image-container">
            <img src="images/${filename}" alt="${item.title}" style="object-position: ${item.position || 'center'};">
            <div class="overlay">
              <h2>${item.title}</h2>
              <p class="date">${item.date || ''}</p>
            </div>
          </div>
        `;
        div.addEventListener('click', () => {
          currentIndex = idx;
          showModal(idx, 0);
        });
        gallery.appendChild(div);
      });
    }
  </script>

  <script>
    const maxBg = 6;
    const bg    = Math.floor(Math.random()*maxBg)+1;
    document.getElementById('fixed-bg').src = `backgrounds/bg${bg}.png`;
  </script>
</body>
</html>
