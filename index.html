<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>agent z Art Archivals</title>
  <link rel="stylesheet" href="style.css">

  <link rel="icon" type="image/png" sizes="16x16" href="serverImages/fovicon-16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="serverImages/fovicon-32.png">
  <link rel="shortcut icon" href="serverImages/fovicon.ico">
</head>
<body>
  <img id="fixed-bg" alt="Background" />
  <div style="text-align: center; margin-top: 20px;">
    <img src="serverImages/logo.png" alt="Art Archives Logo" style="max-width: 500px; height: auto;">
  </div>
  <div id="filter-bar"></div>
  <div class="gallery" id="gallery"></div>

  <div id="modal" class="modal">
    <span class="close">&times;</span>
    <div class="modal-content">

      <!-- Image + variant buttons wrapper -->
      <div class="modal-image-wrapper">
        <img id="modal-img" src="" alt="">
        <div class="variant-buttons"></div>
      </div>

      <!-- Textual details -->
      <h2 id="modal-title"></h2>
      <p id="modal-description"></p>
      <p id="modal-date" class="modal-date"></p>

      <!-- Social icons -->
      <div class="modal-icons"></div>
    </div>
  </div>

  <p class="navigation-hint">Use ← and → arrow keys to navigate</p>

  <script>
    let currentIndex = 0,
        artData      = [],
        includeTags  = new Set(),
        excludeTags  = new Set();
  
    const TAG_ORDER = [ /* … */ ];
    const filterBar = document.getElementById('filter-bar');
    const gallery   = document.getElementById('gallery');
    const modal     = document.getElementById('modal');
    const modalImg  = document.getElementById('modal-img');
    const modalTitle= document.getElementById('modal-title');
    const modalDesc = document.getElementById('modal-description');
    const modalDate = document.getElementById('modal-date');
    const iconsEl   = document.querySelector('.modal-icons');
    const vbEl      = document.querySelector('.variant-buttons');
    const navHint   = document.querySelector('.navigation-hint');
    const closeBtn  = document.querySelector('.close');
  
    // … your TAG_ORDER.forEach(...) and matchesFilter() here …
  
    let itemNodes = [];
    function buildGallery() {
      gallery.innerHTML = '';
      itemNodes = artData.map((item, idx) => {
        const thumb       = item.variants?.[0] || item.filename;
        const hasVariants = item.variants?.length > 1;
        const div = document.createElement('div');
        div.className = 'art-item';
        div.innerHTML = `
          <div class="image-container">
            <img class="thumb" loading="lazy"
                 src="images/${thumb}"
                 alt="${item.title.replace(/"/g,'&quot;')}"
                 style="object-position:${item.position||'center'};">
            ${hasVariants
               ? `<img class="variant-icon"
                       src="serverImages/variant-icon.png"
                       alt="Has Variants">`
               : ''}
            <div class="overlay">
              <h2>${item.title.replace(/</g,'&lt;')}</h2>
              <p class="date">${item.date||''}</p>
            </div>
          </div>`;
        div.addEventListener('click', ()=> showModal(idx, 0));
        gallery.appendChild(div);
        return div;
      });
    }

    let pendingRender = false;
    function renderGallery() {
      if (pendingRender) return;
      pendingRender = true;
      requestAnimationFrame(() => {
        itemNodes.forEach((div, idx) => {
          div.style.display = matchesFilter(artData[idx].tags || []) ? '' : 'none';
        });
        pendingRender = false;
      });
    }
  
    function showModal(index, variantIndex = 0) {
      const item     = artData[index];
      if (!item) return;
      const variants = item.variants || [item.filename];
  
      // Show selected variant
      modalImg.src        = `images/${variants[variantIndex]}`;
      modalImg.alt        = item.title;
      modalTitle.textContent = item.title;
      modalDesc.textContent  = item.description || '';
      modalDate.textContent  = item.date || '';
  
      // Preload the other variants
      variants
        .filter((_, i) => i !== variantIndex)
        .forEach(fn => {
          const img = new Image();
          img.src   = `images/${fn}`;
        });
  
      // Build the variant buttons
      vbEl.innerHTML = '';
      if (variants.length > 1) {
        variants.forEach((_, i) => {
          const b = document.createElement('button');
          b.textContent = i + 1;
          b.className   = 'variant-btn' + (i === variantIndex ? ' active' : '');
          b.addEventListener('click', e => {
            e.stopPropagation();
            showModal(index, i);
          });
          vbEl.appendChild(b);
        });
      }
  
      iconsEl.innerHTML = '';
      if (item.youtube) iconsEl.innerHTML += `
        <a href="${item.youtube}" target="_blank" class="source-icon">
          <img src="serverImages/youtube-icon.png" alt="YouTube">
        </a>`;
      if (item.twitter) iconsEl.innerHTML += `
        <a href="${item.twitter}" target="_blank" class="source-icon">
          <img src="serverImages/twitter-icon.png" alt="Twitter">
        </a>`;
      if (item.bluesky) iconsEl.innerHTML += `
        <a href="${item.bluesky}" target="_blank" class="source-icon">
          <img src="serverImages/bluesky-icon.png" alt="Bluesky">
        </a>`;
  
      modal.style.display   = 'flex';
      navHint.style.display = 'block';
      currentIndex          = index;
    }
  
    closeBtn.onclick = () => { modal.style.display = 'none'; navHint.style.display = 'none'; };
    window.onclick   = e => { if (e.target === modal) closeBtn.onclick(); };
    document.addEventListener('keydown', e => {
      if (modal.style.display === 'flex') {
        if (e.key === 'ArrowLeft'  && currentIndex > 0)              showModal(--currentIndex, 0);
        if (e.key === 'ArrowRight' && currentIndex < artData.length-1) showModal(++currentIndex, 0);
        if (e.key === 'Escape')                                       closeBtn.onclick();
      }
    });
  
    // Fetch & initialize
    fetch('data.json')
      .then(r => r.json())
      .then(data => {
        artData = data;
        buildGallery();
        renderGallery();
      });
  </script>
  <script>
    const maxBg = 7;
    const bg    = Math.floor(Math.random()*maxBg)+1;
    document.getElementById('fixed-bg').src = `backgrounds/bg${bg}.png`;
  </script>
</body>
</html>
